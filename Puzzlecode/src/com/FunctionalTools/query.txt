INSERT  /*+ append nologging */  INTO NPO_SALES_TYPE2_DATA (DFU_ID, STARTDATE, QTY, RSRC_ID) 


 SELECT DFUDT.DFU_ID ,DFUDT.STARTDATE, SUM(QTY) QTY, DFUDT.LOC
 FROM PROCESSNPODFU PNPODFU, HIST, NPO_DFU_DT DFUDT
 WHERE PNPODFU.NPO_DFU_ID  = DFUDT.DFU_ID 
 AND PNPODFU.DFU_STARTDATE = DFUDT.STARTDATE 
 AND HIST.DMDUNIT          = DFUDT.DMDUNIT
 AND HIST.DMDGROUP         = DFUDT.DMDGROUP
 AND HIST.LOC              = DFUDT.LOC
 AND HIST.EVENT IN ()
 AND DFUDT.STARTDATE  BETWEEN HIST.STARTDATE AND (HIST.STARTDATE+HIST.DUR/1440-1)
 AND PNPODFU.PROCESSID = ? 
 AND PNPODFU.ACTION_NUMBER = ? 
 AND HIST.TYPE=2 and HIST.HISTSTREAM = ? 
 GROUP  BY DFUDT.DFU_ID, DFUDT.STARTDATE, DFUDT.LOC 

 SELECT DFU_ID, STARTDATE, QTY FROM NPO_SALES_TYPE2_DATA WHERE RSRC_ID = ? ORDER BY DFU_ID, STARTDATE 





SELECT DFUDT.DFU_ID ,DFUDT.STARTDATE, SUM(DFUDT.EXT_HIST_QTY) QTY
 FROM PROCESSNPODFU PNPODFU, NPO_DFU_DT DFUDT
 WHERE PNPODFU.NPO_DFU_ID  = DFUDT.DFU_ID 
 AND PNPODFU.DFU_STARTDATE = DFUDT.STARTDATE 
 AND PNPODFU.PROCESSID = ? 
 AND PNPODFU.ACTION_NUMBER = ? 
 GROUP  BY DFUDT.DFU_ID, DFUDT.STARTDATE 
 ORDER  BY DFUDT.DFU_ID
